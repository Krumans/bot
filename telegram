import telebot
from telebot import types

token=''
bot=telebot.TeleBot(token)

referrals = {}
balances = {}
profiles = {}
likes = {}

@bot.message_handler(commands=['start'])
def start(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    button1 = types.KeyboardButton('–ú–æ—è –∫–æ–º–∞–Ω–¥–∞')
    button2 = types.KeyboardButton('–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å')
    button3 = types.KeyboardButton('–ú–æ—è –∞–Ω–∫–µ—Ç–∞')
    button4 = types.KeyboardButton('–ó–Ω–∞–∫–æ–º—Å—Ç–≤–∞')
    markup.row(button1, button2, button3, button4)
    bot.send_message(message.chat.id, '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!', reply_markup=markup)

@bot.message_handler(content_types=['text'])
def handle_text(message):
    if message.text == '–ú–æ—è –∫–æ–º–∞–Ω–¥–∞':
        pass  # –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
    elif message.text == '–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å':
        create_profile(message)
    elif message.text == '–ú–æ—è –∞–Ω–∫–µ—Ç–∞':
        show_profile(message)
    elif message.text == '–ó–Ω–∞–∫–æ–º—Å—Ç–≤–∞':
        show_profiles(message)

def create_profile(message):
    msg = bot.send_message(message.chat.id, "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è.")
    bot.register_next_step_handler(msg, process_name_step)

def process_name_step(message):
    try:
        name = message.text
        chat_id = message.chat.id
        user_id = message.from_user.id
        profiles[user_id] = {'name': name}
        msg = bot.send_message(message.chat.id, '–°–ø–∞—Å–∏–±–æ, {}! –¢–µ–ø–µ—Ä—å –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–∑—Ä–∞—Å—Ç.'.format(name))
        bot.register_next_step_handler(msg, process_age_step)
    except Exception as e:
        bot.reply_to(message, 'oooops: {}'.format(e))

def process_age_step(message):
    try:
        age = message.text
        chat_id = message.chat.id
        user_id = message.from_user.id
        profiles[user_id]['age'] = age
        msg = bot.send_message(message.chat.id, '–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–≤–æ—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é.')
        bot.register_next_step_handler(msg, process_photo_step)
    except Exception as e:
        bot.reply_to(message, 'oooops: {}'.format(e))

def process_photo_step(message):
    try:
        photo = message.photo[-1].file_id if message.photo else None
        chat_id = message.chat.id
        user_id = message.from_user.id
        profiles[user_id]['photo'] = photo
        msg = bot.send_message(message.chat.id, '–°–ø–∞—Å–∏–±–æ –∑–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é! –¢–µ–ø–µ—Ä—å —Ä–∞—Å—Å–∫–∞–∂–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ –æ —Å–µ–±–µ.')
        bot.register_next_step_handler(msg, process_bio_step)
    except Exception as e:
        bot.reply_to(message, 'oooops: {}'.format(e))

def process_bio_step(message):
    try:
        bio = message.text
        chat_id = message.chat.id
        user_id = message.from_user.id
        profiles[user_id]['bio'] = bio
        markup = types.InlineKeyboardMarkup()
        markup.add(types.InlineKeyboardButton('–ú—É–∂—Å–∫–æ–π', callback_data='–ú—É–∂—Å–∫–æ–π'),
                   types.InlineKeyboardButton('–ñ–µ–Ω—Å–∫–∏–π', callback_data='–ñ–µ–Ω—Å–∫–∏–π'),
                   types.InlineKeyboardButton('–î—Ä—É–≥–æ–µ', callback_data='–î—Ä—É–≥–æ–µ'))
        bot.send_message(message.chat.id, '–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π –ø–æ–ª.', reply_markup=markup)
    except Exception as e:
        bot.reply_to(message, 'oooops: {}'.format(e))

@bot.callback_query_handler(func=lambda call: call.data in ['–ú—É–∂—Å–∫–æ–π', '–ñ–µ–Ω—Å–∫–∏–π', '–î—Ä—É–≥–æ–µ'])
def process_gender_step(call):
    try:
        gender = call.data
        chat_id = call.message.chat.id
        user_id = call.from_user.id
        profiles[user_id]['gender'] = gender
        markup = types.InlineKeyboardMarkup()
        markup.add(types.InlineKeyboardButton('–ì–µ—Ç–µ—Ä–æ', callback_data='–ì–µ—Ç–µ—Ä–æ'),
                   types.InlineKeyboardButton('–ì–µ–π', callback_data='–ì–µ–π'),
                   types.InlineKeyboardButton('–õ–µ—Å–±–∏', callback_data='–õ–µ—Å–±–∏'),
                   types.InlineKeyboardButton('–ë–∏', callback_data='–ë–∏'),
                   types.InlineKeyboardButton('–ü–∞–Ω—Å–µ–∫—Å—É–∞–ª', callback_data='–ü–∞–Ω—Å–µ–∫—Å—É–∞–ª'),
                   types.InlineKeyboardButton('–ê—Å–µ–∫—Å—É–∞–ª', callback_data='–ê—Å–µ–∫—Å—É–∞–ª'),
                   types.InlineKeyboardButton('–î—Ä—É–≥–æ–µ', callback_data='–î—Ä—É–≥–æ–µ'))
        bot.edit_message_text(chat_id=chat_id, message_id=call.message.message_id, text='–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ—é –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é.', reply_markup=markup)
    except Exception as e:
        bot.send_message(chat_id, 'oooops: {}'.format(e))

@bot.callback_query_handler(func=lambda call: call.data in ['–ì–µ—Ç–µ—Ä–æ', '–ì–µ–π', '–õ–µ—Å–±–∏', '–ë–∏', '–ü–∞–Ω—Å–µ–∫—Å—É–∞–ª', '–ê—Å–µ–∫—Å—É–∞–ª', '–î—Ä—É–≥–æ–µ'])
def process_orientation_step(call):
    try:
        orientation = call.data
        chat_id = call.message.chat.id
        user_id = call.from_user.id
        profiles[user_id]['orientation'] = orientation
        markup = types.InlineKeyboardMarkup()
        markup.add(types.InlineKeyboardButton('–û–≤–µ–Ω', callback_data='–û–≤–µ–Ω'),
                   types.InlineKeyboardButton('–¢–µ–ª–µ—Ü', callback_data='–¢–µ–ª–µ—Ü'),
                   types.InlineKeyboardButton('–ë–ª–∏–∑–Ω–µ—Ü—ã', callback_data='–ë–ª–∏–∑–Ω–µ—Ü—ã'),
                   types.InlineKeyboardButton('–†–∞–∫', callback_data='–†–∞–∫'),
                   types.InlineKeyboardButton('–õ–µ–≤', callback_data='–õ–µ–≤'),
                   types.InlineKeyboardButton('–î–µ–≤–∞', callback_data='–î–µ–≤–∞'),
                   types.InlineKeyboardButton('–í–µ—Å—ã', callback_data='–í–µ—Å—ã'),
                   types.InlineKeyboardButton('–°–∫–æ—Ä–ø–∏–æ–Ω', callback_data='–°–∫–æ—Ä–ø–∏–æ–Ω'),
                   types.InlineKeyboardButton('–°—Ç—Ä–µ–ª–µ—Ü', callback_data='–°—Ç—Ä–µ–ª–µ—Ü'),
                   types.InlineKeyboardButton('–ö–æ–∑–µ—Ä–æ–≥', callback_data='–ö–æ–∑–µ—Ä–æ–≥'),
                   types.InlineKeyboardButton('–í–æ–¥–æ–ª–µ–π', callback_data='–í–æ–¥–æ–ª–µ–π'),
                   types.InlineKeyboardButton('–†—ã–±—ã', callback_data='–†—ã–±—ã'))
        bot.edit_message_text(chat_id=chat_id, message_id=call.message.message_id, text='–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π –∑–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞.', reply_markup=markup)
    except Exception as e:
        bot.send_message(chat_id, 'oooops: {}'.format(e))

@bot.callback_query_handler(func=lambda call: call.data in ['–û–≤–µ–Ω', '–¢–µ–ª–µ—Ü', '–ë–ª–∏–∑–Ω–µ—Ü—ã', '–†–∞–∫', '–õ–µ–≤', '–î–µ–≤–∞', '–í–µ—Å—ã', '–°–∫–æ—Ä–ø–∏–æ–Ω', '–°—Ç—Ä–µ–ª–µ—Ü', '–ö–æ–∑–µ—Ä–æ–≥', '–í–æ–¥–æ–ª–µ–π', '–†—ã–±—ã'])
def process_zodiac_step(call):
    try:
        zodiac = call.data
        chat_id = call.message.chat.id
        user_id = call.from_user.id
        profiles[user_id]['zodiac'] = zodiac
        markup = types.InlineKeyboardMarkup()
        markup.add(types.InlineKeyboardButton('–î—Ä—É–∂–±–∞', callback_data='–î—Ä—É–∂–±–∞'),
                   types.InlineKeyboardButton('–ù–∞–π—Ç–∏ –ª—é–±–æ–≤—å', callback_data='–ù–∞–π—Ç–∏ –ª—é–±–æ–≤—å'),
                   types.InlineKeyboardButton('–û—Ç–Ω–æ—à–µ–Ω–∏—è –±–µ–∑ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤', callback_data='–û—Ç–Ω–æ—à–µ–Ω–∏—è –±–µ–∑ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤'),
                   types.InlineKeyboardButton('–û–±—â–µ–Ω–∏–µ', callback_data='–û–±—â–µ–Ω–∏–µ'))
        bot.edit_message_text(chat_id=chat_id, message_id=call.message.message_id, text='–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞.', reply_markup=markup)
    except Exception as e:
        bot.send_message(chat_id, 'oooops: {}'.format(e))

@bot.callback_query_handler(func=lambda call: call.data in ['–î—Ä—É–∂–±–∞', '–ù–∞–π—Ç–∏ –ª—é–±–æ–≤—å', '–û—Ç–Ω–æ—à–µ–Ω–∏—è –±–µ–∑ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤', '–û–±—â–µ–Ω–∏–µ'])
def process_goal_step(call):
    try:
        goal = call.data
        chat_id = call.message.chat.id
        user_id = call.from_user.id
        profiles[user_id]['goal'] = goal
        msg = bot.send_message(chat_id, '–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –≤–≤–µ–¥–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É, –≤ –∫–æ—Ç–æ—Ä–æ–π –≤—ã –ø—Ä–æ–∂–∏–≤–∞–µ—Ç–µ.')
        bot.register_next_step_handler(msg, process_country_step)
    except Exception as e:
        bot.send_message(chat_id, 'oooops: {}'.format(e))

def process_country_step(message):
    try:
        country = message.text
        chat_id = message.chat.id
        user_id = message.from_user.id
        profiles[user_id]['country'] = country
        msg = bot.send_message(chat_id, '–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –≤–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—ã –ø—Ä–æ–∂–∏–≤–∞–µ—Ç–µ.')
        bot.register_next_step_handler(msg, process_city_step)
    except Exception as e:
        bot.reply_to(message, 'oooops: {}'.format(e))

def process_city_step(message):
    try:
        city = message.text
        chat_id = message.chat.id
        user_id = message.from_user.id
        profiles[user_id]['city'] = city
        msg = bot.send_message(message.chat.id, '–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Å–≤–æ—é –≥–µ–æ–ø–æ–∑–∏—Ü–∏—é –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å", —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–æ—Ç —à–∞–≥.')
        bot.register_next_step_handler(msg, process_location_step)
    except Exception as e:
        bot.reply_to(message, 'oooops: {}'.format(e))

@bot.message_handler(content_types=['location', 'text'])
def process_location_step(message):
    try:
        if message.content_type == 'location':
            location = message.location
            profiles[message.from_user.id]['location'] = location
        else:
            profiles[message.from_user.id]['location'] = '–ù–µ —É–∫–∞–∑–∞–Ω–æ'
        bot.send_message(message.chat.id, '–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!')
    except Exception as e:
        bot.reply_to(message, 'oooops: {}'.format(e))

def show_profile(message):
    user_id = message.from_user.id
    if user_id in profiles:
        profile = profiles[user_id]
        response = f"–ò–º—è: {profile['name']}\n–í–æ–∑—Ä–∞—Å—Ç: {profile['age']}\n–°—Ç—Ä–∞–Ω–∞: {profile['country']}\n–ì–æ—Ä–æ–¥: {profile['city']}\n–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è: {profile['orientation']}\n–ü–æ–ª: {profile['gender']}\n–ó–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞: {profile['zodiac']}\n–¶–µ–ª—å –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞: {profile['goal']}"
        bot.send_photo(message.chat.id, profile['photo'], caption=response)
        markup = types.InlineKeyboardMarkup()
        markup.add(types.InlineKeyboardButton('–ò–∑–º–µ–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É', callback_data='edit_profile'))
        bot.send_message(message.chat.id, '–í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Å–≤–æ—é –∞–Ω–∫–µ—Ç—É, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ.', reply_markup=markup)
    else:
        bot.send_message(message.chat.id, "–ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å.")

@bot.callback_query_handler(func=lambda call: call.data == 'edit_profile')
def edit_profile(call):
    create_profile(call.message)

def show_profiles(message):
    user_id = message.from_user.id
    user_profile = profiles.get(user_id)
    if user_profile:
        for profile_id, profile in profiles.items():
            if profile_id != user_id and profile['city'] == user_profile['city'] and profile['country'] == user_profile['country']:
                markup = types.InlineKeyboardMarkup()
                markup.add(types.InlineKeyboardButton('‚ù§Ô∏è', callback_data=f'like_{profile_id}'),
                           types.InlineKeyboardButton('üëé', callback_data=f'dislike_{profile_id}'))
                bot.send_photo(message.chat.id, profile['photo'], caption=f"{profile['name']}, {profile['age']}", reply_markup=markup)
    else:
        bot.send_message(message.chat.id, "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å.")

@bot.callback_query_handler(func=lambda call: call.data.startswith('like_'))
def like_profile(call):
    user_id = call.from_user.id
    liked_user_id = int(call.data.split('_')[1])
    likes.setdefault(user_id, []).append(liked_user_id)
    if liked_user_id in likes and user_id in likes[liked_user_id]:
        bot.send_message(user_id, f"–í—ã –≤–∑–∞–∏–º–Ω–æ –ª–∞–π–∫–Ω—É–ª–∏ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {liked_user_id}!")
        markup = types.InlineKeyboardMarkup()
        markup.add(types.InlineKeyboardButton('–ü–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è', url=f't.me/c/{liked_user_id}'))
        bot.send_photo(user_id, profiles[liked_user_id]['photo'], caption=f"{profiles[liked_user_id]['name']}, {profiles[liked_user_id]['age']}", reply_markup=markup)

@bot.callback_query_handler(func=lambda call: call.data.startswith('dislike_'))
def dislike_profile(call):
    # –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ "–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è", –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
    pass

bot.polling()
